<!DOCTYPE html>
<html id="blue">
  <head>
<title>Final Project</title>
<meta charset="UTF-8" />
<link rel="shortcut icon" href="icon.ico" />
<link rel="stylesheet" href="FinalProject.css" type="text/css"/>
<script
src="https://code.jquery.com/jquery-3.5.1.js"
integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>

<script id="PopularContentTemp" type="text/template">
  {{#results}}
  <div id="HomeMovie" class="{{id}}"tabindex='0'>
  <div id="HomeMovieCover">
  <p><img src="https://image.tmdb.org/t/p/w300/{{poster_path}}" alt="{{title}}{{name}}"></p>
  </div>
  <h2>{{title}} {{name}}</h2>
  <p>{{overview}}</p>
  <div id="{{id}}"></div>
  <button>Add to Favorites</button><button>Add to Watch List</button>
</div>
{{/results}}
</script>

<script id="SearchTemp" type="text/template">
  {{#results}}
  <div id="SearchMovie" class="{{id}}" tabindex='0'>
  <div id="SearchMovieCover">
  <p><img src="https://image.tmdb.org/t/p/w300/{{poster_path}}" alt="{{title}}{{name}}"></p>
  </div>
  <h2>{{title}} {{name}}</h2>
  <p>{{overview}}</p>
  <p>{{genre}}</p>
  
  <button>Add to Favorites</button><button>Add to Watch List</button>
</div>
{{/results}}
</script>

<script id="FavoritesTemp" type="text/template">
  {{#results}}
  <div id="FavoritesMovie" class="{{id}}" tabindex='0'>
  <div id="FavoritesMovieCover">
  <br>
  <p><img src="https://image.tmdb.org/t/p/w300/{{poster_path}}" alt="{{title}}{{name}}"></p>
  </div>
  <h2>{{title}} {{name}}</h2>
  <p>{{overview}}</p>
  <p>{{genre}}</p>
 
  <button>Add to Favorites</button><button>Add to Watch List</button>
</div>
{{/results}}
</script>

<script id="WatchListTemp" type="text/template">
  {{#results}}
  <div id="WatchListMovie" class="{{id}}" tabindex='0'>
  <div id="WatchListMovieCover">
  <h2>{{title}}</h2>
  <br>
  <p><img src="https://image.tmdb.org/t/p/w200/{{poster_path}}" alt="{{title}}"></p>
  </div>
  <p>{{overview}}</p>
  <p>{{genre}}</p>
  <button>Add to Favorites</button><button>Add to Watch List</button>
</div>
{{/results}}
</script>

<script id="CastTemp" type="text/template">
  {{#cast}}
  <div id="SearchMovie">
    <div id="SearchMovieCover">
      <h2>{{name}}</h2>
    <p><img src="https://image.tmdb.org/t/p/w300/{{profile_path}}" alt="{{title}}"></p>
    </div>
</div>
{{/cast}}
</script>


<script type="text/javascript">

/*variables*/
var startIndex=1;
var popularIndex=1;
var FavoritesIndex=1;
var WatchListIndex=1;
var searchButton=1;
var HomeIndex=1;
var bool=0;
var totalResults=0;
var searchtext;  
var request_token;
var HomeToggle=1;
var session_id;
var account_id=10437136;
var mediaMenu="movies";
var mediaSearch="movie";
var WatchListTotalResults =1;
var FavoritesTotalResults =1;
var movie_id;
var movie=[];
var noResults= "<div class='glass'><h2>404 no results found</h2></div>";
/*page actions*/
$(document).ready(function(){
  $Authentication();
  $searchButtonColor();
  $PopularContent();
  console.log(request_token);
$('input:radio[name="SearchDisplayOption"]').change(
  function(){
    if ($('#list_option_one').is(':checked') && $('#list_option_one').val() == 'l') {
      $('#searchResults').css('flex-direction','column');
      console.log("search column");
    }
    else{
      $('#searchResults').css('flex-direction','row');
      console.log("search row");
    }
  });
$('input:radio[name="FavoritesDisplayOption"]').change(
  function(){
    if ($('#list_option_two').is(':checked') && $('#list_option_two').val() == 'l') {
      $('#FavoritesResults').css('flex-direction','column');
      $('#WatchListResults').css('flex-direction','column');
      console.log("Menu shelf column");
    }
    else{
      $('#FavoritesResults').css('flex-direction','row');
      $('#WatchListResults').css('flex-direction','row');
      console.log("menu shelf row");
    }
  });
 
/*toggle actions*/
$("#HomeOption").click(function(){
    $clearpage();
    HomeToggle=0;
    console.log(HomeToggle);
    $('#Home').show();
    $("#HomeResults").show();
});
$("#MenuOption").click(function(){
    HomeToggle=2;
    console.log(HomeToggle);
    $clearpage();
    $('#Menu').show();
});
$("#SearchOption").click(function(){
    HomeToggle=2;
    console.log(HomeToggle);
    $clearpage();
    $('#SearchTab').show();
});

$('.FavoritesToggle').click(function(){
    $('#MenuNameWatchList').hide();
    $('#MenuNameFavorites').show();
    $('#WatchListResults').hide();
    $('#FavoritesResults').show();
    $('#WatchListNav').hide();
    $('#FavoritesNav').show();
    console.log("show favorites")
});

$('.WatchListToggle').click(function(){
    $('#MenuNameWatchList').show();
    $('#MenuNameFavorites').hide();
    $('#WatchListResults').show();
    $('#FavoritesResults').hide();
    $('#WatchListNav').show();
    $('#FavoritesNav').hide();
    console.log("Show watch List")
});
$('.MenuMovieToggle').click(function(){
  WatchListIndex=1;
  FavoritesIndex=1;
  mediaMenu ="movies";
  $clearFavoritesSearch();
  $clearWatchListSearch();
  $WatchListSearch();
  $FavoritesSearch();
 
});
$('.MenuTvToggle').click(function(){
  WatchListIndex=1;
  FavoritesIndex=1;
  mediaMenu ="tv";
  $clearFavoritesSearch();
  $clearWatchListSearch();
  $WatchListSearch();
  $FavoritesSearch();

});
$('.SearchMovieToggle').click(function(){
  startIndex=1;
  mediaSearch ="movie";
  $clearFavoritesSearch();
  $searchMovie();
 
});
$('.SearchTvToggle').click(function(){
  startIndex=1;
  mediaSearch ="tv";
  $clearSearch();
  $searchMovie();

});
$("#SearchButton").click(function(){
      console.log("search submitted");
      searchtext = $('#textbox').val();
     console.log(searchtext);
      if(searchtext == ''){
        alert("Please enter something to search");
    }
    else{
      if(bool > 0){
    console.log("clear");
    $clearSearch();
      }
    startIndex=1;
    searchButton=1;
    $clearSearch();
    $searchMovie();
    $searchButtonColor();
    }
});
/*Nav buttons*/
$('#searchNavButton1', ).click(function(){
  $clearSearch();
  startIndex=1; 
  searchButton=1;
  $searchMovie();
  $searchButtonColor();
});
$('#searchNavButton2', ).click(function(){
  $clearSearch();
  startIndex=2; 
  searchButton=2;
  $searchMovie();
  $searchButtonColor();
});
$('#searchNavButton3', ).click(function(){
  $clearSearch();
  startIndex=3; 
  searchButton=3;
  $searchMovie();
  $searchButtonColor();
});
$('#searchNavButton4', ).click(function(){
  $clearSearch();
  startIndex=4; 
  searchButton=4;
  $searchMovie();
  $searchButtonColor();
});
$('#searchNavButton5', ).click(function(){
  $clearSearch();
  startIndex=5; 
  searchButton=5;
  $searchMovie();
  $searchButtonColor();
});
$('#FavoritesNavButton1', ).click(function(){
  if(FavoritesIndex==1){
    alert("Can't go back");
  }else{
  $clearFavoritesSearch();
  FavoritesIndex++; 
  $FavoritesSearch();
  }
});
$('#FavoritesNavButton2', ).click(function(){
  if(FavoritesIndex>=FavoritesTotalResults){
    alert("End of Results");
  }else{
  $clearWatchListSearch();
  FavoritesIndex++; 
  $FavoritesSearch();
  }
});
$('#WatchListNavButton1', ).click(function(){
  if(WatchListIndex==1){
    alert("Can't go back");
  }else{
  $clearWatchListSearch();
  WatchListIndex--; 
  $WatchListSearch();
  }
});
$('#WatchListNavButton2', ).click(function(){
  if(WatchListIndex>=WatchListTotalResults){
    alert("End of Results");
  }else{
  $clearFavoritesSearch();
  WatchListIndex++; 
  $WatchListSearch();
  }
});

$(window).on("scroll", function() {
 //page height
 var scrollHeight = $(document).height();
 //scroll position
 var scrollPos = $(window).height() + $(window).scrollTop();
 // fire if the scroll position is 300 pixels above the bottom of the page
 if(HomeToggle <= 1){
 if(((scrollHeight - 300) >= scrollPos) / scrollHeight == 0){
   HomeIndex++;
   $PopularContent();
  }
  }
});

});
/*Functions*/
$clearpage = function(){
    $('#welcome').hide();
    $('#Home').hide();
    $('#Menu').hide();
    $('#SearchTab').hide();

}

GetURLParameter = function (sParam){
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++)
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam)
        {
            return decodeURIComponent(sParameterName[1]);
        }
    }
}
$clearSearch = function(){
    $("div[id*='SearchMovie']").each(function (x, pj) {
    $(pj).remove();
    console.log("book removed");
 });
}
$clearHome = function(){
    $("div[id*='HomeMovie']").each(function (x, pj) {
    $(pj).remove();
    console.log("home removed");
 });
}
$clearFavoritesSearch = function(){
    $("div[id*='FavoritesMovie']").each(function (x, pj) {
    $(pj).remove();
    console.log("Favorites's page cleared");
 });
}
$clearWatchListSearch = function(){
    $("div[id*='WatchListMovie']").each(function (x, pj) {
    $(pj).remove();
    console.log("WatchList's page removed");
 });
}
/*API key: 4b1b68988784917b4b649f5723b60b02*/
/*API Read acess Token (v4 auth)*/
/*eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0YjFiNjg5ODg3ODQ5MTdiNGI2NDlmNTcyM2I2MGIwMiIsInN1YiI6IjYwODgyMDExODQ0NDhlMDA3OTMyMmNmNyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.6OfaTVdNW_bl1UnDPDklp2zz0hION_VRzjdPc54nJ54*/
/*https://api.themoviedb.org/*/
$Authentication=function(){
  request_token=GetURLParameter('request_token');
  console.log("Request Token: " + request_token);
  console.log("session_ID:"+session_id);
  if(request_token == undefined){
    $GetToken();
  } else if(session_id == undefined){
   $GetSession();
 }
}
$GetToken=function(){
  $.get("https://api.themoviedb.org/3/authentication/token/new?api_key=4b1b68988784917b4b649f5723b60b02", function(searchResponse){
   console.log(searchResponse);
   request_token = searchResponse.request_token;
   var account='<div class="glass"><p><a href="https://www.themoviedb.org/authenticate/'+request_token+'?redirect_to=https://baileyknez.azurewebsites.net/FinalProject.html">Click to enable list</a></p></div>';
   $("#FavoritesResults").append(account);
   $("#WatchListResults").append(account);
  });
}
$GetSession=function(){
  $.post("https://api.themoviedb.org/3/authentication/session/new?api_key=4b1b68988784917b4b649f5723b60b02", {'request_token':request_token}, function(searchResponse){
     console.log(searchResponse);
     session_id =searchResponse.session_id;
     AccountDetail();
     $FavoritesSearch();
     $WatchListSearch();
     $('#FavoritesNav').show();
  });
  if(session_id == undefined){
    $GetToken();
  }
}
  
 AccountDetail = function(){
  $.get("https://api.themoviedb.org/3/account?api_key=4b1b68988784917b4b649f5723b60b02&session_id="+session_id, function(searchResponse){
     console.log(searchResponse);
     account_id =searchResponse.id;
     console.log(account_id);
    });
 }
$searchMovie = function(){
  console.log(mediaSearch);
  $.get( "https://api.themoviedb.org/3/search/"+mediaSearch+"?api_key=4b1b68988784917b4b649f5723b60b02&query="+searchtext+"&page="+startIndex, function(searchResponse){
    console.log(searchResponse);
    console.log("search from:" + startIndex);
    var searchdata, cover;
    
    bool++;
    var template = $('#SearchTemp').html();
    var text = Mustache.render(template, searchResponse);
    $("#searchResults").html(text);
    console.log("book made");
    
    for(i = 0; i < searchResponse.results.length; i++) {
    movie_id = searchResponse.results[i].id;
    movie.push(""+movie_id)

    var addByID = searchResponse.results[i].id;
    console.log("addByID: "+ addByID);
    }
    $addCast();
  });
  
  $("#searchNav").show();
}

$addCast = function(){
    for(i = 0; i < movie.length; i++) {
    $.get( "https://api.themoviedb.org/3/movie/"+movie[i]+"/credits?api_key=4b1b68988784917b4b649f5723b60b02", function(castResponse){
    console.log(castResponse);
    console.log(castResponse.id);
    var template = $('#CastTemp').html();
    var text = Mustache.render(template, castResponse);

    var id = "."+castResponse.id
    console.log("ID: "+id)
    $(id).append(text);
    console.log("Cast made");
  });
  }
}

$PopularContent=function(){
  $.get("https://api.themoviedb.org/3/trending/all/day?api_key=4b1b68988784917b4b649f5723b60b02&page="+ HomeIndex, function(searchResponse){
   console.log(searchResponse);
   console.log("search from:" + popularIndex);
   totalResults=searchResponse.total_pages;
   console.log("total results:"+totalResults);

   var template = $('#PopularContentTemp').html();
   var text = Mustache.render(template, searchResponse);
   $("#HomeResults").append(text);

   for(i = 0; i < searchResponse.results.length; i++) {
    movie_id = searchResponse.results[i].id;
    movie.push(""+movie_id)

    var addByID = searchResponse.results[i].id;
    console.log("addByID: "+ addByID);
   }
   $addCast();
  });
}

$FavoritesSearch=function(){
  $.get("https://api.themoviedb.org/3/account/10437136/favorite/"+mediaMenu+"?api_key=4b1b68988784917b4b649f5723b60b02&session_id="+session_id+"&language=en-US&sort_by=created_at.asc&page="+FavoritesIndex, function(searchResponse){
  console.log(searchResponse);
   console.log("search from:" + FavoritesIndex);
   FavoritesTotalResults=searchResponse.total_pages;
   console.log("total results:"+totalResults)
    

   var template = $('#FavoritesTemp').html();
   var text = Mustache.render(template, searchResponse);
   $("#FavoritesResults").html(text);
   console.log("favorites made");
   
   if(FavoritesTotalResults==0){
    $("#FavoritesResults").append(noResults);
    console.log("no results");
   }
   for(i = 0; i < searchResponse.results.length; i++) {
    movie_id = searchResponse.results[i].id;
    movie.push(""+movie_id)

    var addByID = searchResponse.results[i].id;
    console.log("addByID: "+ addByID);
   }
   $addCast();
  });
};

$WatchListSearch=function(){
    $.get("https://api.themoviedb.org/3/account/10437136/watchlist/"+mediaMenu+"?api_key=4b1b68988784917b4b649f5723b60b02&language=en-US&session_id="+session_id+"&sort_by=created_at.asc&page="+WatchListIndex, function(searchResponse){
   console.log(searchResponse);
   console.log("search from:" + WatchListIndex);
   WatchListTotalResults=searchResponse.total_pages;
   console.log("total results:"+totalResults);
   
  
   var template = $('#WatchListTemp').html();
   var text = Mustache.render(template, searchResponse);
   $("#WatchListResults").html(text);
   console.log("WatchList made");

   if(WatchListTotalResults==0){
    $("#WatchListResults").append(noResults);
    console.log("no results");
   }
   for(i = 0; i < searchResponse.results.length; i++) {
    movie_id = searchResponse.results[i].id;
    movie.push(""+movie_id)

    var addByID = searchResponse.results[i].id;
    console.log("addByID: "+ addByID);
   }
   $addCast();
  });
};
$searchButtonColor = function(){
  $searchButtonWhite();
  switch(searchButton){
    case 1:
      $("#searchNavButton1").css("background-color","rgba(211, 206, 206, 0.582)");
    break;
    case 2:      
      $("#searchNavButton2").css("background-color","rgba(211, 206, 206, 0.582)");
    break;
    case 3:     
      $("#searchNavButton3").css("background-color","rgba(211, 206, 206, 0.582)");
    break;
    case 4:    
      $("#searchNavButton4").css("background-color","rgba(211, 206, 206, 0.582)");
    break;
    case 5:
      $("#searchNavButton5").css("background-color","rgba(211, 206, 206, 0.582)");
    break;

  }
};
$searchButtonWhite = function(){
  $("#searchNavButton1").css("background-color","rgba(255, 255, 255, .7)");
  $("#searchNavButton2").css("background-color","rgba(255, 255, 255, .7)");
  $("#searchNavButton3").css("background-color","rgba(255, 255, 255, .7)");
  $("#searchNavButton4").css("background-color","rgba(255, 255, 255, .7)");
  $("#searchNavButton5").css("background-color","rgba(255, 255, 255, .7)");
};

</script>
</head>
<nav>
  <p id="SearchOption">Search</p>
  <p id="HomeOption">Home</p>
  <p id="MenuOption">Menu</p> 

</nav>

<div id="welcome">
  <div class="glass">
    <h1>Welcome!</h1>
    <br>
    <p>Welcome to our Final Project. This page was made using TMDB API, AJAX, JQUERY, and Musache.js</p>
    <br>
    <p>Made by:</p>
    <p><a href="https://baileyknez.azurewebsites.net/">Bailey Knezevich</a></p> 
    <p><a href="https://prempatel.azurewebsites.net/">Prem Patel</a></p>
  </div>
</div>

<div id="Home">
  <div class="glass">
      <h1>Home</h1>
      <h2>Our Popular Movies at the moment</h2>
</div>
<div id="HomeResults"></div>
</div>

<div id="SearchTab">
  <div class="glass">
    <div class="searchbox">
      <h1>Search</h1>
      <p><span class="SearchMovieToggle">Movie</span> | <span class="SearchTvToggle">TV</span></p>
        <input id="textbox" type="search" >
        <button id="SearchButton">  Search Books  </button>
    </div>
  </div>
  <div id="displayOption">
    <p>Display Options</p>
    <table>
      <tr>
       <td> 
         <input type="radio" id="list_option_one" name="SearchDisplayOption" value="l">
         <br>
        <label for="list_option_one">List</label>
      </td>
      <td>
        <input type="radio" id="grid_option_one" name="SearchDisplayOption" value="g" checked="checked">
        <br>
        <label for="grid_option_one">Grid</label>
      </td>
      </tr>
    </table>
  </div>
    <div id="searchResults"></div>
    <div id="searchNav">
      <div id="searchNavContain">
      <br>
      <button id ="searchNavButton1" data-search="0">1</button>
      <button id ="searchNavButton2" data-search="10">2</button>
      <button id ="searchNavButton3" data-search="20">3</button>
      <button id ="searchNavButton4" data-search="30">4</button>
      <button id ="searchNavButton5" data-search="40">5</button>
      <br>
    </div>
    </div>
    <br>
  </div>
<div id="Menu">
  <div class="glass">
    <p><span class="FavoritesToggle">Favorites</span> | <span class="WatchListToggle">Watch List</span></p>
    <h1 id="MenuNameFavorites">Favorites</h1>
    <h1 id="MenuNameWatchList">Watch List</h1>
    <p><span class="MenuMovieToggle">Movie</span> | <span class="MenuTvToggle">TV</span></p>
  </div>
  <div id="displayOption">
    <p>Display Options</p>
    <table>
      <tr>
       <td> 
         <input type="radio" id="list_option_two" name="FavoritesDisplayOption" value="l" >
         <br>
        <label for="list_option_two">List</label>
      </td>
      <td>
        <input type="radio" id="grid_option_two" name="FavoritesDisplayOption" value="g" checked="checked">
        <br>
        <label for="grid_option_two">Grid</label>
      </td>
      </tr>
    </table>
  </div>
    <div id="FavoritesResults"></div>
    <div id="WatchListResults"></div>
    <div id="FavoritesNav">
    <div id="searchNavContain" >
      <br>
      <button id ="FavoritesNavButton1" data-search="0">Back</button>
      <button id ="FavoritesNavButton2" data-search="10">Next Page</button>
    </div>
  </div>
    <div id="WatchListNav">
    <div id="searchNavContain" >
      <br>
      <button id ="WatchListNavButton1" data-search="0">Back</button>
      <button id ="WatchListNavButton2" data-search="10">Next Page</button>
    </div>
  </div>

</div>
</div>
</div>
</html>

